model Character {
  id     String     @id @default(uuid())
  name   String
  age    Int
  userId String     @db.Text
  user   users_sync @relation(fields: [userId], references: [id], onDelete: Cascade)
  gender Gender?

  // High-level stats
  level            Int        @default(1)
  alignment        Alignment?
  experiencePoints Int        @default(0)

  // Core combat snapshot
  baseHp      Int? // Base HP without modifiers
  maxHp       Int? // Maximum HP after modifiers
  currentHp   Int? // Current HP during gameplay
  tempHp      Int? // Temporary HP from spells/effects
  armorClass  Int?
  speed       Int? // in feet
  inspiration Boolean @default(false)

  // Status
  active     Boolean   @default(true)
  deceased   Boolean   @default(false)
  deceasedAt DateTime?
  retired    Boolean   @default(false)
  retiredAt  DateTime?
  archived   Boolean   @default(false)

  // Useful meta
  notes     String? // freeform description, personality, etc.
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  classLevels               CharacterClassLevel[]
  abilities                 CharacterAbility[]
  skills                    CharacterSkill[]
  inventory                 CharacterItem[]
  spells                    CharacterSpell[]
  race                      Race?                      @relation(fields: [raceId], references: [id])
  raceId                    String?
  background                Background?                @relation(fields: [backgroundId], references: [id])
  backgroundId              String?
  characterSavingThrows     CharacterSavingThrow[]
  characterSpellSlots       CharacterSpellSlot[]
  characterFeatures         CharacterFeature[]
  characterNpcRelationships CharacterNpcRelationship[]
  parties                   PlayerParty[]

  @@schema("public")
}

model CharacterClass {
  id          String @id @default(uuid())
  name        String @unique
  description String
  hitDie      Int // e.g., 10 for d10, 6 for d6

  // For rules-based stuff later
  primaryAbilities     AbilityType[]
  savingThrowProfs     AbilityType[] // e.g. [STR, CON]
  subclasses           Subclass[]
  characterClassLevels CharacterClassLevel[]
  npcs                 Npc[]

  @@schema("public")
}

model Subclass {
  id      String         @id @default(uuid())
  classId String
  class   CharacterClass @relation(fields: [classId], references: [id])

  name        String // e.g., "Champion"
  description String?

  // Features unlocked at certain levels can be a separate table later
  characterClassLevels CharacterClassLevel[]

  @@schema("public")
}

model CharacterClassLevel {
  id          String    @id @default(uuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id])

  classId String
  class   CharacterClass @relation(fields: [classId], references: [id])

  subclassId String?
  subclass   Subclass? @relation(fields: [subclassId], references: [id])

  level           Int // level in THIS class
  hitPointsGained Int? // for tracking HP per level if you want

  // Optional: when this level was added
  createdAt DateTime @default(now())

  @@unique([characterId, classId]) // simple version: one row per class
  @@schema("public")
}

model Race {
  id          String  @id @default(uuid())
  name        String  @unique // "Human", "Elf", etc.
  description String?

  // Could store rules-ish stuff as JSON or separate tables
  // e.g., ability score bonuses, speed, features, etc.

  characters Character[]
  npcs       Npc[]

  @@schema("public")
}

model Background {
  id          String  @id @default(uuid())
  name        String // "Soldier", "Sage", etc.
  description String?

  // Could link to starting proficiencies, equipment, etc. later.

  characters Character[]

  @@schema("public")
}

model CharacterAbility {
  id          String    @id @default(uuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id])

  ability   AbilityType
  baseScore Int // e.g., 15 from point buy
  bonus     Int         @default(0) // racial/feat bonus
  temporary Int         @default(0) // spells, etc.

  @@unique([characterId, ability])
  @@schema("public")
}

model Skill {
  id          String      @id @default(uuid())
  name        String      @unique // "Stealth"
  ability     AbilityType // e.g., DEX-based
  description String?

  characterSkills CharacterSkill[]

  @@schema("public")
}

model CharacterSkill {
  id          String    @id @default(uuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id])

  skillId String
  skill   Skill  @relation(fields: [skillId], references: [id])

  proficiency ProficiencyLevel @default(NORMAL)

  @@unique([characterId, skillId])
  @@schema("public")
}

model CharacterSavingThrow {
  id          String    @id @default(uuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id])

  ability     AbilityType
  proficiency ProficiencyLevel @default(NONE)

  @@unique([characterId, ability])
  @@schema("public")
}

model Feature {
  id          String            @id @default(uuid())
  name        String
  description String?
  sourceType  FeatureSourceType
  sourceId    String? // e.g., id of class / race / feat record

  characterFeatures CharacterFeature[]

  @@schema("public")
}

model CharacterFeature {
  id          String    @id @default(uuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id])

  featureId String
  feature   Feature @relation(fields: [featureId], references: [id])

  // For tracking if this is currently usable / toggled
  usesRemaining Int?
  notes         String?

  @@unique([characterId, featureId])
  @@schema("public")
}
